name: docker-build

on: 
  workflow_dispatch:
  push:
    paths:
      - 'Dockerfile'
      - 'install-deps.sh'
      - 'github/workflows/build-docker-container.yml'
  pull_request:
    paths:
      - 'Dockerfile'
      - 'install-deps.sh'
      - 'github/workflows/build-docker-container.yml'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build_docker:
    name: Build docker container with gfortran
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # Action to checkout your code

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3 # Sets up Docker Buildx for advanced build features

      - name: Log in to Docker Hub (or other registry)
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }} # Use GitHub Secret for username
          password: ${{ secrets.DOCKER_PASSWORD }} # Use GitHub Secret for password

      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: . # Build context (current directory)
          push: true # Push the image to the registry
          tags: jdhughes99/gaia-hbb:latest # Image 
